<!doctype html>
<html>

<head>
    <meta charset="utf-8">

    <!--表格样式可无视-->
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/r/bs-3.3.5/jq-2.1.4,dt-1.10.8/datatables.min.css"/> -->

    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/layui.css">
    <script src="../../lib/jquery.js"></script>

    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            background: #ddd;
        }

        .headbox {
            width: 100%;
            height: 80px;
            background: #017efd;
        }
    </style>

</head>

<body>
    <div class="headbox"></div>

    <div class="panel" style="position: relative;">
        <div id="treeBox"></div>
        <div id="iconList">
            <ul style="height: 510px;overflow-y: scroll;">
                <li class="showMark" data-id="1">
                    <img src="../../image/icon/icon-01.png">
                    <span>十二封灯箱</span>
                </li>
                <li class="showMark" data-id="2">
                    <img src="../../image/icon/icon-02.png">
                    <span>街区图（十二封）</span>
                </li>
                <li class="showMark" data-id="3">
                    <img src="../../image/icon/icon-03.png">
                    <span>运营宣传（十二封）</span>
                </li>
                <li class="showMark" data-id="4">
                    <img src="../../image/icon/icon-04.png">
                    <span>资讯、向导</span>
                </li>
                <li class="showMark" data-id="5">
                    <img src="../../image/icon/icon-05.png">
                    <span>六封灯箱</span>
                </li>
                <li class="showMark" data-id="6">
                    <img src="../../image/icon/icon-06.png">
                    <span>超级灯箱</span>
                </li>
                <li class="showMark" data-id="7">
                    <img src="../../image/icon/icon-07.png">
                    <span>梯眉灯箱</span>
                </li>
                <li class="showMark" data-id="8">
                    <img src="../../image/icon/icon-08.png">
                    <span>柱子</span>
                </li>
                <li class="showMark" data-id="9">
                    <img src="../../image/icon/icon-09.png">
                    <span>梯牌</span>
                </li>
                <li class="showMark" data-id="10">
                    <img src="../../image/icon/icon-10.png">
                    <span>闸机站</span>
                </li>
                <li class="showMark" data-id="11">
                    <img src="../../image/icon/icon-11.png">
                    <span>梯眉</span>
                </li>
                <li class="showMark" data-id="12">
                    <img src="../../image/icon/icon-12.png">
                    <span>梯眉侧</span>
                </li>
                <li class="showMark" data-id="13">
                    <img src="../../image/icon/icon-13.png">
                    <span>玻璃围挡</span>
                </li>
                <li class="showMark" data-id="14">
                    <img src="../../image/icon/icon-14.png">
                    <span>楼梯/电梯</span>
                </li>
                <li class="showMark" data-id="15">
                     <img src="../../image/icon/icon-15.png">
                     <span>售票亭</span>
                </li>
                <li class="showMark" data-id="16">
                     <img src="../../image/icon/icon-16.png">
                     <span>售票机</span>
                </li>
                <li class="showMark" data-id="17">
                     <img src="../../image/icon/icon-17.png">
                     <span>墙贴</span>
                </li>
                <li class="showMark" data-id="18">
                     <img src="../../image/icon/icon-18.png">
                     <span>充值机</span>
                </li>
                <li class="showMark" data-id="19">
                     <img src="../../image/icon/icon-19.png">
                     <span>车辆操控室</span>
                </li>
                <li class="showMark" data-id="20">
                     <img src="../../image/icon/icon-20.png">
                     <span>龙骨架</span>
                </li>
                <li class="showMark" data-id="21">
                     <img src="../../image/icon/icon-21.png">
                     <span>ATM取款机</span>
                </li>
                <li class="showMark" data-id="22">
                     <img src="../../image/icon/icon-22.png">
                     <span>站立式贴</span>
                </li>
                <li class="showMark" data-id="23">
                     <img src="../../image/icon/icon-23.png">
                     <span>地铁公安（十二封）</span>
                </li>
                <li class="showMark" data-id="24">
                     <img src="../../image/icon/icon-24.png">
                     <span>顺德团委（十二封）</span>
                </li>
            </ul>
        </div>
        <div id="container">
            <img src="../../image/cad.jpg">
            <button id="rotate" class="lipButton"></button>
        </div>
        <div class="layui-inline" style="position: absolute; right: 35px; bottom: 300px;">
            <button type="button" id="saveMark" class="layui-btn  layui-btn-normal">保存</button>
        </div>
    </div>

    <script type="text/javascript" src="../../lib/lip-zoom-mark-jquery.js"></script>
    <script type="text/javascript">

        // 初始化组件
        var myobj = $('#container').ZoomMark({
            'markColor': 'blue',
            'afterMark': addRowToTabel
        });


        // 添加完标记回调
        function addRowToTabel(marks) {
            // $(".mark").oncontextmenu(function(){
            //     alert(123);
            // })
            console.log(marks);
        }

        // 删除标记
        function deleteMark(id) {
            $('#container').ZoomMark('deleteMark', id);
        }

        $(".showMark").mousedown(function () {
            var oId = $(this).data("id");
            if(oId<10) {
                oId = "0"+ oId;
            }
            $('#container').ZoomMark("setAddState", oId);
        })

        // 初始化底图缩放比例
        function initZoom(scale, x, y) {
            $('#container').ZoomMark("zoom", scale, x, y);
        }

        // 获取底图及标记数据
        function getZoomMarkData() {
            return $('#container').ZoomMark("getZoomMarkData");
        }

        // 初始化底图状态(只调用一次)
        function initMapState() {
            // 缩放底图
            $('#container').ZoomMark('changeSettings', {
                imgPosition: {
                    height: 3825,
                    rotate: 0,
                    scale: 8,
                    width: 6800,
                    x: -2764,
                    y: -1647.5
                }
            });
            // 绘制标点
            $('#container').ZoomMark('setMarkList', [
                {
                    x: 496,
                    y: 305
                },
                {
                    x: 490,
                    y: 420
                }
            ])
            // 校准
            initZoom(1);
        }

        
/* 
    * 解析matrix矩阵，0°-360°，返回旋转角度 
    * 当a=b||-a=b,0<=deg<=180 
    * 当-a+b=180,180<=deg<=270 
    * 当a+b=180,270<=deg<=360 
    * 
    * 当0<=deg<=180,deg=d; 
    * 当180<deg<=270,deg=180+c; 
    * 当270<deg<=360,deg=360-(c||d); 
    * */  
    function getmatrix(a,b,c,d,e,f){  
        var aa=Math.round(180*Math.asin(a)/ Math.PI);  
        var bb=Math.round(180*Math.acos(b)/ Math.PI);  
        var cc=Math.round(180*Math.asin(c)/ Math.PI);  
        var dd=Math.round(180*Math.acos(d)/ Math.PI);  
        var deg=0;  
        if(aa==bb||-aa==bb){  
            deg=dd;  
        }else if(-aa+bb==180){  
            deg=180+cc;  
        }else if(aa+bb==180){  
            deg=360-cc||360-dd;  
        }  
        return deg>=360?0:deg;  
        //return (aa+','+bb+','+cc+','+dd);  
    }  


        var step = 15;
        $("#rotate").click(function(){
          var rId =  $('#container').ZoomMark("getRotateId"); 
          if(rId!='temp'){
                var deg = eval("get"+ $("#mark_"+rId).css("transform"));
                $("#mark_"+rId).css({'transform':'rotate('+(deg+step)%360+'deg)'});
          }
        })

        $("#saveMark").click(function(){
            layer.msg("保存成功！");
        })

    </script>
    <script src="../../layui.js"></script>
    <script src="./mapMark.js"></script>
</body>

</html>