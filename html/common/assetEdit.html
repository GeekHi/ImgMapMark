<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>资产信息</title>
  <link rel="stylesheet" href="../../css/layui.css">
</head>

<body>
  <div style="padding: 10px;">
    <form class="layui-form" lay-filter="assetsEditForm">
      <div class="layui-form-item layui-row">
        <div class="layui-col-xs6">
          <label class="layui-form-label">资产用途</label>
          <div class="layui-input-block">
            <select name="assetsCategory" lay-filter="useOptions">
              <option value="1">商业</option>
              <option value="2">广告</option>
              <option value="3">通信</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs6">
          <label class="layui-form-label">资产编号</label>
          <div class="layui-input-block">
            <input type="text" name="assetsId" required lay-verify="required" placeholder="请输入资产编号" autocomplete="off"
              class="layui-input">
          </div>
        </div>
      </div>
      <div id="formItemContain"></div>
      <div class="layui-form-item layui-row" id="area-picker">
        <div class="layui-form-label">行政区域</div>
        <div class="layui-input-inline" style="width: 200px;">
          <select name="prov" class="province-selector" data-value="广东省" lay-filter="province-1">
            <option value="">请选择省</option>
          </select>
        </div>
        <div class="layui-input-inline" style="width: 200px;">
          <select name="city" class="city-selector" data-value="佛山市" lay-filter="city-1">
            <option value="">请选择市</option>
          </select>
        </div>
        <div class="layui-input-inline" style="width: 200px;">
          <select name="area" class="county-selector" data-value="南海区" lay-filter="county-1">
            <option value="">请选择区</option>
          </select>
        </div>
      </div>
      <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
          <textarea name="remark" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
      </div>

    </form>
  </div>

  <!-- 广告资产表单 -->
  <script id="advertisingForm" type="text/html">
    <div class="layui-form-item layui-row">
        <div class="layui-col-xs6">
          <label class="layui-form-label">媒体名称</label>
          <div class="layui-input-block">
            <select name="assetsName">
              <option value="1">十二封灯箱</option>
              <option value="2">街区图（十二封）</option>
              <option value="3">资讯、导向</option>
              <option value="4">超级灯箱</option>
              <option value="5">梯眉灯箱</option>
              <option value="6">电视机</option>
              <option value="7">梯牌</option>
              <option value="8">六封灯箱</option>
              <option value="9">立柱灯箱</option>
              <option value="10">龙门架</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs6">
          <label class="layui-form-label">物理线路</label>
          <div class="layui-input-block">
              <select name="physicsLine">
                  <option value="广佛线">广佛线</option>
              </select>
          </div>
        </div>
      </div>
      <div class="layui-form-item layui-row">
          <div class="layui-col-xs6">
            <label class="layui-form-label">分段线路</label>
            <div class="layui-input-block">
              <select name="segmentLine">
                <option value="广佛线二期">广佛线二期</option>
                <option value="广佛线后通段">广佛线后通段</option>
                <option value="广佛线首通段">广佛线首通段</option>
              </select>
            </div>
          </div>
          <div class="layui-col-xs6">
            <label class="layui-form-label">站点</label>
            <div class="layui-input-block">
                <select name="station" id="stationOpts"></select>
            </div>
          </div>
        </div>
        <div class="layui-form-item layui-row">
            <div class="layui-col-xs6">
                <label class="layui-form-label">使用状态</label>
                <div class="layui-input-block">
                  <input type="radio" name="status" value="可用" title="可用" checked>
                  <input type="radio" name="status" value="不可用" title="不可用" >
                </div>
            </div>
            <div class="layui-col-xs6">
                <label class="layui-form-label">开通时间</label>
                <div class="layui-input-block">
                    <input type="text" name="beginDate" autocomplete="off" placeholder="选择开通时间" class="layui-input" id="startDate">
                </div>
              </div>
          </div>
</script>

  <!-- 商业资产表单 -->
  <script id="commercialForm" type="text/html">
    <div class="layui-form-item layui-row">
        <div class="layui-col-xs6">
          <label class="layui-form-label">媒体名称</label>
          <div class="layui-input-block">
            <select name="assetsName">
              <option value="20">商铺</option>
              <option value="21">自助售卖机</option>
              <option value="22">自助照相机</option>
              <option value="23">自助雨伞</option>
              <option value="24">自助售卡机</option>
              <option value="25">自助充值机</option>
              <option value="26">写字楼</option>
              <option value="27">车位</option>
              <option value="28">公寓</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs6">
          <label class="layui-form-label">物理线路</label>
          <div class="layui-input-block">
              <select name="physicsLine">
                  <option value="广佛线">广佛线</option>
                </select>
          </div>
        </div>
      </div>
      <div class="layui-form-item layui-row">
          <div class="layui-col-xs6">
            <label class="layui-form-label">分段线路</label>
            <div class="layui-input-block">
              <select name="segmentLine">
                <option value="广佛线二期">广佛线二期</option>
                <option value="广佛线后通段">广佛线后通段</option>
                <option value="广佛线首通段">广佛线首通段</option>
              </select>
            </div>
          </div>
          <div class="layui-col-xs6">
            <label class="layui-form-label">站点</label>
            <div class="layui-input-block">
                <select name="station" id="stationOpts"></select>
            </div>
          </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">使用状态</label>
            <div class="layui-input-block">
              <input type="radio" name="letStatus" value="可用" title="可用" checked>
              <input type="radio" name="letStatus" value="不可用" title="不可用" >
            </div>
          </div>
          <div class="layui-form-item layui-row" >
                 <div class="layui-col-xs6">
                    <label class="layui-form-label">承租方名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="leaseName" required lay-verify="required" placeholder="请输入承租方名称" autocomplete="off"
                        class="layui-input">
                    </div>
                 </div>
                 <div class="layui-col-xs6">
                    <label class="layui-form-label">开始出租</label>
                    <div class="layui-input-block">
                        <input type="text" name="beginDate" placeholder="出租开始日期" autocomplete="off" class="layui-input" id="startDate">
                    </div>
                  </div>
            </div>
          <div class="layui-form-item layui-row">
                <div class="layui-col-xs6">
                    <label class="layui-form-label">出租结束</label>
                    <div class="layui-input-block">
                        <input type="text" name="endDate" placeholder="出租结束日期" autocomplete="off" class="layui-input" id="endDate">
                    </div>
                  </div>
                  <div class="layui-col-xs6">
                      <label class="layui-form-label">交铺日期</label>
                      <div class="layui-input-block">
                          <input type="text" name="deliveryDate" autocomplete="off"  placeholder="选择交铺日期" class="layui-input" id="transDate">
                      </div>
                    </div>
          </div>
    </script>

  <!-- 通信资产表单 -->
  <script id="communicationForm" type="text/html">

      <div class="layui-form-item layui-row">
          <div class="layui-col-xs6">
            <label class="layui-form-label">资产名称</label>
            <div class="layui-input-block">
                <input type="text" name="assetsName" required lay-verify="required" placeholder="请输入资产名称" autocomplete="off"
                class="layui-input">
            </div>
          </div>
          <div class="layui-col-xs6">
            <label class="layui-form-label">计量单位</label>
            <div class="layui-input-block">
                <input type="text" name="unit" required lay-verify="required" placeholder="请输入计量单位" autocomplete="off"
                class="layui-input">
            </div>
          </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">使用状态</label>
            <div class="layui-input-block">
              <input type="radio" name="status" value="可用" title="可用" checked>
              <input type="radio" name="status" value="不可用" title="不可用" >
            </div>
          </div>
</script>


  <script src="../../layui.js"></script>
  <script>

    // 工具方法
    function getQueryString(name) {
      var getParam = function (keyname) {
        var reg = new RegExp("(^|&)" + keyname + "=([^&]*)(&|$)", "i");
        var r = decodeURIComponent(window.location.search).substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
      }
      if (typeof name == 'string') return getParam(name);
      else {
        var result = {};
        for (var i = 0; i < name.length; i++) {
          var keyName = name[i];
          result[keyName] = getParam(keyName);
        }
        return result;
      }
    }

    //配置插件目录
    layui.config({
      base: '../../mods/'
      , version: '1.0'
    });
    layui.use(['layer', 'form', 'laydate', 'layarea'], function () {
      var layer = layui.layer
        , form = layui.form
        , $ = layui.$
        , laydate = layui.laydate
        , layarea = layui.layarea;

      var formInitObj = null;
      var stationOptsObj = null;
      var Use_Type = 1; // 默认商业

      layarea.render({
        elem: '#area-picker'
      });

      var editFlag = getQueryString("editFlag"); // 1新增  2编辑
      var editId = getQueryString("editId");  // 编辑索引id
      var asset_id = getQueryString("assetsId");

      initPage();

      // 初始化页面
      function initPage() {
        // 默认编辑商业类型
        $("#formItemContain").html($("#commercialForm").html());
         queryStationOpts();
         initStationOpts();
         initDate();
        if (editFlag == 2) {
          queryAssetDetail();
        }
      }


      // 初始化表单状态
      function formInit() {
        initStationOpts();
        initDate();
        if (formInitObj != null && formInitObj.assetsCategory == Use_Type) {
          layui.form.val("assetsEditForm", formInitObj);
          form.render();
        }
      }

      // 查询资产详情
      function queryAssetDetail() {
        $.ajax({
          url: "/gzdt/backstage/assets/find",
          type: "post",
          dataType: "json",
          headers: {
            token: localStorage.gfToken,
            accountId: localStorage.gfaccountId
          },
          async: false,
          data: {
            assetsId: asset_id
          },
          success: function (result) {
            if (result.res == 1) {
                formInitObj = result.obj;
                Use_Type = formInitObj.assetsCategory;
                handleFormItem();
            }
          }
        })
      }

      // 获取所有站点option
      function queryStationOpts() {
        $.ajax({
          url: "/gzdt/backstage/sysDict/findauto",
          type: "post",
          dataType: "json",
          async: false,
          data: {
            paramKey: "zd"
          },
          success: function (result) {
            if (result.res == 1) {
              stationOptsObj = result.obj;
            }
          }
        })
      }

      //初始化站点下拉列表
      function initStationOpts() {
        var tempArr = [];
        $.each(stationOptsObj, function (index, item) {
          tempArr.push('<option value="' + item.paramName + '">' + item.paramName + '</option>')
        })
        $("#stationOpts").html(tempArr.join(""));
        form.render();
      }

      // 监听资产用途选择
      form.on("select(useOptions)", function (data) {
        Use_Type = data.value;
        handleFormItem();
      })

      // 动态表单切换
      function handleFormItem(){
        switch (Use_Type) {
          case '1':
            $("#formItemContain").html($("#commercialForm").html());
            formInit();
            break;
          case '2':
            $("#formItemContain").html($("#advertisingForm").html());
            formInit();
            break;
          case '3':
            $("#formItemContain").html($("#communicationForm").html());
            formInit();
            break;
        }
      }

      // 初始化时间组件
      function initDate() {
        laydate.render({
          elem: '#startDate',
          trigger: "click"
        });
        laydate.render({
          elem: '#endDate',
          trigger: "click"
        });
        laydate.render({
          elem: '#transDate',
          trigger: "click"
        });
      }

      // 保存资产编辑信息
      top.saveAssetInfo = function () {
        var formData = layui.form.val("assetsEditForm");
        // 保存商业
        if (formData.assetsCategory == 1) {
          saveBusinessAssets(formData);
        }
        // 保存广告
        if (formData.assetsCategory == 2) {
          saveAdAssets(formData);
        }
        // 保存通信
        if (formData.assetsCategory == 3) {
          saveCommunicateAssets(formData);
        }

      }

      // 添加广告资产
      function saveAdAssets(parmData) {
        /*
              <option value="1">十二封灯箱</option>
              <option value="2">街区图（十二封）</option>
              <option value="3">资讯、导向</option>
              <option value="4">超级灯箱</option>
              <option value="5">梯眉灯箱</option>
              <option value="6">电视机</option>
              <option value="7">梯牌</option>
              "8": "6封灯箱",
              "9":"立柱灯箱",
              "10":"龙门架",
              "11":"车厢看板",

              "1":"灯箱类",
              "2":"梯牌类",
              "3":"门架类",
              "4":"商铺",
              "5":"自助设备",
              "6":"写字楼",
              "7":"车位",
              "8":"公寓",
              "9":"电视机"
              "10":"看板"
        */

        if (parmData.assetsName == "1" || parmData.assetsName == "2" || parmData.assetsName == "3" || parmData.assetsName == "4" || parmData.assetsName == "5"|| parmData.assetsName == "8"|| parmData.assetsName == "9") {
          parmData.assetsType = "1";
        }


        if (parmData.assetsName == "6") {
          parmData.assetsType = "9";
        }


        if (parmData.assetsName == "7") {
          parmData.assetsType = "2";
        }
        if (parmData.assetsName == "10") {
          parmData.assetsType = "3";
        }

        if (parmData.assetsName == "11") {
          parmData.assetsType = "10";
        }

        var url = "/gzdt/backstage/assets/addAdAssets";
        if (editFlag == 2) {
          parmData.id = editId;
          url = "/gzdt/backstage/assets/updateAdAssets";
        }

        $.ajax({
          url: url,
          type: "post",
          contentType: "application/json; charset=utf-8",
          headers: {
            token: localStorage.gfToken,
            accountId: localStorage.gfaccountId
          },
          dataType: "json",
          async: false,
          data: JSON.stringify(parmData),
          success: function (result) {
            if (result.res == 1) {
              top.onSaveSuccess(result);
            } else {
              top.onSavefail(result);
            }
          }
        })
      }

      // 保存商业资产
      function saveBusinessAssets(parmData) {
        /*
              <option value="20">商铺</option>
              <option value="21">自助售卖机</option>
              <option value="22">自助照相机</option>
              <option value="23">自助雨伞</option>
              <option value="24">自助售卡机</option>
              <option value="25">自助充值机</option>
              <option value="26">写字楼</option>
              <option value="27">车位</option>
              <option value="28">公寓</option>

              "1":"灯箱类",
              "2":"梯牌类",
              "3":"门架类",
              "4":"商铺",
              "5":"自助设备",
              "6":"写字楼",
              "7":"车位",
              "8":"公寓",
              "9":"电视机"
        */
        if (parmData.assetsName == '20') {
          parmData.assetsType = '4';
        }
        if (parmData.assetsName == "21" || parmData.assetsName == "22" || parmData.assetsName == "23" || parmData.assetsName == "24" || parmData.assetsName == "25") {
          parmData.assetsType = '5';
        }
        if (parmData.assetsName == "26") {
          parmData.assetsType = '6';
        }
        if (parmData.assetsName == "27") {
          parmData.assetsType = '7';
        }
        if (parmData.assetsName == "28") {
          parmData.assetsType = '8';
        }

        var url = "/gzdt/backstage/assets/addBusinessAssets";
        if (editFlag == 2) {
          parmData.id = editId;
          url = "/gzdt/backstage/assets/updateBusinessAssets";
        }
        $.ajax({
          url: url,
          type: "post",
          contentType: "application/json; charset=utf-8",
          headers: {
            token: localStorage.gfToken,
            accountId: localStorage.gfaccountId
          },
          dataType: "json",
          async: false,
          data: JSON.stringify(parmData),
          success: function (result) {
            if (result.res == 1) {
              top.onSaveSuccess(result);
            } else {
              top.onSavefail(result);
            }
          }
        })
      }

      //添加通信资产
      function saveCommunicateAssets(parmData) {
        var url = "/gzdt/backstage/assets/addCommunicateAssets";
        parmData.assetsType = "999";
        if (editFlag == 2) {
          parmData.id = editId;
          url = "/gzdt/backstage/assets/updateCommunicateAssets";
        }
        $.ajax({
          url: url,
          type: "post",
          contentType: "application/json; charset=utf-8",
          headers: {
            token: localStorage.gfToken,
            accountId: localStorage.gfaccountId
          },
          dataType: "json",
          async: false,
          data: JSON.stringify(parmData),
          success: function (result) {
            if (result.res == 1) {
              top.onSaveSuccess(result);
            } else {
              top.onSavefail(result);
            }
          }
        })

      }

    });
  </script>
</body>

</html>